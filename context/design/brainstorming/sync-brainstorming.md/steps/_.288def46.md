---
timestamp: 'Tue Nov 25 2025 19:25:42 GMT-0500 (Eastern Standard Time)'
parent: '[[..\20251125_192542.e5baf9ac.md]]'
content_id: 288def469816ffb9b52b5adef062839481683d68e3bc4ab17532d824c492b3ff
---

# ItemTransaction

**concept**: ItemTransaction \[User, Item]
**purpose**: To manage the active lifecycle of an approved exchange, from pickup to completion, ensuring both parties have a shared record of the transaction's state.
**principle**: Once a request is accepted, a transaction is created. The borrower can then mark the item as picked up, and later as returned, moving the transaction through its lifecycle until it is successfully completed.

**state**:

* a set of ItemTransactions with
  * a from User
  * a to User
  * an item Item
  * a type of BORROW or TRANSFER or ITEM
  * a status of PENDING\_PICKUP or IN\_PROGRESS or PENDING\_RETURN or COMPLETED or CANCELLED
  * a fromNotes String
  * a toNotes String
  * a createdAt Date
  * an optional pickedUpAt Date
  * an optional returnedAt Date

**actions**:

* `createTransaction (from: User, to: User, item: Item, type: BORROW or TRANSFER or ITEM, fromNotes: String, toNotes: String): (transaction: ItemTransaction)`
  * **system**
  * **requires**: A corresponding request must have been accepted.
  * **effects**: Creates a new transaction record with status PENDING\_PICKUP.
* `markPickedUp (transaction: ItemTransaction): ()`
  * **requires**: The transaction must be in PENDING\_PICKUP status.
  * **effects**: Sets status to IN\_PROGRESS (for BORROW) or COMPLETED (for TRANSFER/ITEM) and records `pickedUpAt`.
* `markReturned (transaction: ItemTransaction): ()`
  * **requires**: The transaction must be in IN\_PROGRESS status and of type BORROW.
  * **effects**: Sets status to PENDING\_RETURN and records `returnedAt`.
* `confirmReturn (transaction: ItemTransaction): ()`
  * **requires**: The transaction must be in PENDING\_RETURN status.
  * **effects**: Sets the status to COMPLETED, finalizing the transaction.
* `cancelTransaction (transaction: ItemTransaction): ()`
  * **requires**: The transaction must be in PENDING\_PICKUP or IN\_PROGRESS status.
  * **effects**: Sets the status to CANCELLED.

**notes:**

* **Authorization rules**: The actors for each action must be clearly defined:
  * `markPickedUp`: Can be performed by either party (`from` or `to`)
  * `markReturned`: Can only be performed by the borrower (`to`)
  * `confirmReturn`: Can only be performed by the item's original owner (`from`)
  * `cancelTransaction`: Can be performed by either party, but canceling while `IN_PROGRESS` might negatively impact a user's reputation score via a sync
